<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Race Task Assigner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f0f9ff;
            background-image: radial-gradient(#e0f2fe 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        #raceCanvas {
            border-radius: 1rem;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .animate-wave {
            animation: wave 2s ease-in-out infinite;
        }

        .result-row {
            animation: slideIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateX(-10px);
        }

        @keyframes slideIn {
            to { opacity: 1; transform: translateX(0); }
        }

        #volumeBtn {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 100;
        }

        /* Modal styling */
        .modal-overlay {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col">

    <!-- Audio Toggle -->
    <button id="volumeBtn" onclick="toggleMute()" class="p-3 bg-white rounded-full shadow-lg border border-slate-200 hover:bg-slate-50 transition-all active:scale-90">
        <span id="volumeIcon" class="text-2xl">üîä</span>
    </button>

    <div class="max-w-3xl mx-auto w-full flex-grow">
        <!-- Header -->
        <header class="text-center mb-10">
            <div class="inline-block p-3 bg-white rounded-2xl shadow-sm mb-4 animate-wave">
                <span id="headerEmoji" class="text-4xl">ü¶Ü</span>
            </div>
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight mb-2">
                <span id="titlePrefix">Duck</span> Race <span class="text-sky-500">Assigner</span>
            </h1>
            <p class="text-slate-500 text-lg font-medium">Assigning presentation parts for Science class!</p>
        </header>

        <!-- Input Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="glass-panel p-5 rounded-3xl shadow-lg">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-xs font-bold text-slate-700 uppercase tracking-widest">Racers (Students)</label>
                    <span id="nameCount" class="px-2 py-0.5 bg-sky-100 text-sky-600 text-[10px] font-black rounded-full">0</span>
                </div>
                <textarea id="namesInput" class="w-full h-32 p-3 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-sky-400 transition-all resize-none custom-scrollbar outline-none text-slate-600 text-sm font-medium" placeholder="Gek&#10;Sim&#10;Lim">Gek
Sim
Lim</textarea>
            </div>

            <div class="glass-panel p-5 rounded-3xl shadow-lg">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-xs font-bold text-slate-700 uppercase tracking-widest">Tasks (Parts)</label>
                    <span id="taskCount" class="px-2 py-0.5 bg-indigo-100 text-indigo-600 text-[10px] font-black rounded-full">0</span>
                </div>
                <textarea id="tasksInput" class="w-full h-32 p-3 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-indigo-400 transition-all resize-none custom-scrollbar outline-none text-slate-600 text-sm font-medium" placeholder="Pengenalan & Isi 1&#10;Isi 2 & Isi 3&#10;Isi 4 & Kesimpulan">Pengenalan & Isi 1
Isi 2 & Isi 3
Isi 4 & Kesimpulan</textarea>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center mb-8">
            <button id="startBtn" onclick="prepareRace()" class="group relative px-10 py-4 bg-slate-900 text-white font-bold rounded-2xl transition-all hover:bg-sky-600 hover:scale-105 active:scale-95 shadow-xl">
                <span id="btnText" class="flex items-center gap-2">üèÅ Start Race</span>
            </button>
            <p id="errorMsg" class="mt-4 text-red-500 font-bold hidden bg-white px-4 py-2 rounded-lg shadow-sm border border-red-100 text-sm"></p>
        </div>

        <!-- Race Track -->
        <div id="race-container" class="hidden mb-10">
            <div class="bg-sky-400 p-1 rounded-3xl shadow-2xl overflow-hidden border-4 border-white">
                <div class="bg-sky-200 relative overflow-x-auto">
                    <canvas id="raceCanvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Results List -->
        <div id="results-section" class="hidden max-w-xl mx-auto">
            <div class="flex justify-between items-end mb-6">
                <div>
                    <h2 class="text-2xl font-extrabold text-slate-800 tracking-tight">Race Rankings</h2>
                    <p class="text-slate-500 text-sm font-medium">Final assignments based on arrival order</p>
                </div>
                <button id="copyBtn" onclick="copyResults()" class="px-4 py-2 bg-emerald-500 text-white text-xs font-bold rounded-lg hover:bg-emerald-600 transition-all flex items-center gap-2 shadow-lg shadow-emerald-100">
                    <span>üìã</span> Copy Results
                </button>
            </div>
            
            <div id="results" class="space-y-3 mb-10">
                <!-- Result rows will be injected here -->
            </div>
        </div>
    </div>

    <!-- Footer Controls & Copyright -->
    <div class="max-w-3xl mx-auto w-full pb-8 flex flex-col items-center gap-6">
        <button id="snailToggle" onclick="toggleSnailMode()" class="flex items-center gap-3 px-6 py-3 bg-white border-2 border-slate-200 rounded-2xl shadow-sm hover:bg-slate-50 transition-all group">
            <span id="snailIcon" class="text-2xl group-hover:scale-125 transition-transform">üêå</span>
            <span id="snailLabel" class="font-bold text-slate-700 text-sm">Switch to Snail Mode</span>
        </button>

        <footer id="copyrightFooter" onclick="handleCopyrightClick()" class="cursor-pointer select-none py-4 text-slate-400 text-xs font-medium tracking-widest uppercase hover:text-slate-600 transition-colors">
            ¬© TienPing @ 2026
        </footer>
    </div>

    <!-- Hidden Info Modal -->
    <div id="infoModal" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4 modal-overlay">
        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full border border-slate-100 scale-90 transition-transform duration-300 transform opacity-0" id="modalContent">
            <div class="text-center">
                <div class="w-16 h-16 bg-sky-100 text-sky-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">üë®‚Äçüè´</div>
                <h3 class="text-xl font-extrabold text-slate-900 mb-2">Lim Tien Ping</h3>
                <div class="space-y-2 mb-6">
                    <p class="text-slate-500 text-sm font-medium break-all">petwesley@gmail.com</p>
                    <p class="text-slate-500 text-sm font-medium break-all">g-39576509@moe-dl.edu.my</p>
                </div>
                <button onclick="closeInfoModal()" class="w-full py-3 bg-slate-900 text-white font-bold rounded-xl hover:bg-slate-800 transition-all">Close</button>
            </div>
        </div>
    </div>

    <!-- Celebration Layer -->
    <canvas id="confetti" class="fixed inset-0 pointer-events-none z-50"></canvas>

    <script>
        const namesInput = document.getElementById('namesInput');
        const tasksInput = document.getElementById('tasksInput');
        const nameCountEl = document.getElementById('nameCount');
        const taskCountEl = document.getElementById('taskCount');
        const startBtn = document.getElementById('startBtn');
        const copyBtn = document.getElementById('copyBtn');
        const errorMsg = document.getElementById('errorMsg');
        const resultsContainer = document.getElementById('results');
        const raceContainer = document.getElementById('race-container');
        const raceCanvas = document.getElementById('raceCanvas');
        const ctx = raceCanvas.getContext('2d');
        const resultsSection = document.getElementById('results-section');
        const volumeIcon = document.getElementById('volumeIcon');
        const infoModal = document.getElementById('infoModal');
        const modalContent = document.getElementById('modalContent');

        let isSnailMode = false;
        let isMuted = false; 
        
        // Copyright Click Tracking
        let clickTimes = [];
        function handleCopyrightClick() {
            const now = Date.now();
            clickTimes.push(now);
            
            // Filter clicks to only those within the last 2 seconds
            clickTimes = clickTimes.filter(t => now - t < 2000);
            
            if (clickTimes.length >= 8) {
                showInfoModal();
                clickTimes = []; // Reset
            }
        }

        function showInfoModal() {
            infoModal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-90', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeInfoModal() {
            modalContent.classList.add('scale-90', 'opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                infoModal.classList.add('hidden');
            }, 300);
        }

        // Audio elements
        const quackAudio = new Audio('https://tienping.github.io/public_resources/audio/quak.mp3');
        const snailAudio = new Audio('https://tienping.github.io/public_resources/audio/snail.mp3');

        const SPLASH_PALETTE = [
            { normal: 'rgba(255, 255, 255, 0.8)', boost: 'rgba(251, 191, 36, 0.9)' },
            { normal: 'rgba(191, 219, 254, 0.8)', boost: 'rgba(59, 130, 246, 0.9)' },
            { normal: 'rgba(233, 213, 255, 0.8)', boost: 'rgba(168, 85, 247, 0.9)' },
            { normal: 'rgba(187, 247, 208, 0.8)', boost: 'rgba(34, 197, 94, 0.9)' },
            { normal: 'rgba(254, 202, 202, 0.8)', boost: 'rgba(239, 68, 68, 0.9)' },
            { normal: 'rgba(254, 215, 170, 0.8)', boost: 'rgba(249, 115, 22, 0.9)' },
            { normal: 'rgba(165, 243, 252, 0.8)', boost: 'rgba(6, 182, 212, 0.9)' },
            { normal: 'rgba(251, 207, 232, 0.8)', boost: 'rgba(236, 72, 153, 0.9)' }
        ];

        const duckImage = new Image();
        duckImage.src = "https://tienping.github.io/public_resources/duck%20small.png";

        let ducks = [];
        let tasksList = [];
        let resultsData = [];
        let animationId;
        let finishedDucks = 0;
        let lastSpeedUpdate = 0;
        const SPEED_UPDATE_INTERVAL = 800; 

        const LANE_HEIGHT = 60;
        const DUCK_DISPLAY_SIZE = 45; 
        const FINISH_LINE_PADDING = 80;
        const TOP_PADDING = 30;

        function toggleMute() {
            isMuted = !isMuted;
            volumeIcon.textContent = isMuted ? 'üîá' : 'üîä';
        }

        function playSound(type) {
            if (isMuted) return;
            
            if (type === 'duck') {
                for (let i = 0; i < 3; i++) {
                    const delay = (Math.random() * 400 + 200) * i; 
                    setTimeout(() => {
                        if (isMuted) return;
                        const instance = quackAudio.cloneNode();
                        instance.volume = 0.3;
                        instance.play().catch(() => {});
                    }, delay);
                }
            } else {
                const soundToPlay = snailAudio.cloneNode();
                soundToPlay.volume = 0.3;
                soundToPlay.play().catch(() => {});
            }
        }

        function updateCounts() {
            const names = getList(namesInput.value);
            const tasks = getList(tasksInput.value);
            nameCountEl.textContent = names.length;
            taskCountEl.textContent = tasks.length;
        }

        function getList(text) {
            return text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        }

        function toggleSnailMode() {
            isSnailMode = !isSnailMode;
            document.getElementById('headerEmoji').textContent = isSnailMode ? 'üêå' : 'ü¶Ü';
            document.getElementById('titlePrefix').textContent = isSnailMode ? 'Snail' : 'Duck';
            document.getElementById('snailIcon').textContent = isSnailMode ? 'ü¶Ü' : 'üêå';
            document.getElementById('snailLabel').textContent = isSnailMode ? 'Switch to Duck Mode' : 'Switch to Snail Mode';
            document.getElementById('btnText').textContent = isSnailMode ? 'üèÅ Start Snail Race' : 'üèÅ Start Race';
        }

        namesInput.addEventListener('input', updateCounts);
        tasksInput.addEventListener('input', updateCounts);

        class Splash {
            constructor(x, y, speed, isBoosted, color) {
                this.x = x;
                this.y = y;
                this.size = (Math.random() * 2 + 1) * (speed * 2 + 0.5) * (isBoosted ? 4 : 3);
                this.alpha = 0.8;
                this.dx = - (Math.random() * speed * 0.5 + 0.3);
                this.dy = (Math.random() - 0.5) * (isBoosted ? 3 : 1.5);
                this.baseColor = color;
                this.isSnail = isSnailMode;
            }
            update() {
                if (this.isSnail) {
                    this.alpha -= 0.005;
                } else {
                    this.x += this.dx;
                    this.y += this.dy;
                    this.alpha -= 0.02;
                }
            }
            draw(ctx) {
                ctx.fillStyle = this.baseColor.replace(/[\d.]+\)$/g, `${this.alpha})`);
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Duck {
            constructor(name, laneIndex) {
                this.name = name;
                this.laneIndex = laneIndex;
                this.x = 20;
                this.y = laneIndex * LANE_HEIGHT + (LANE_HEIGHT / 2) + TOP_PADDING;
                this.setRandomSpeed();
                this.finished = false;
                this.wobble = Math.random() * Math.PI * 2;
                this.splashes = [];
                this.isBoosted = false;
                this.rank = 0;
                this.colorTheme = SPLASH_PALETTE[laneIndex % SPLASH_PALETTE.length];
                this.nextSoundTime = Math.random() * 1000 + 500;
            }

            setRandomSpeed(isLast = false) {
                let baseSpeed = (Math.random() * 1.2 + 0.05);
                if (isSnailMode) {
                    baseSpeed /= 3; 
                }
                this.speed = baseSpeed;
                this.isBoosted = isLast;
                if (isLast) {
                    this.speed *= (isSnailMode ? 1.3 : 1.6); 
                }
            }

            update(finishLineX, deltaTime) {
                if (this.finished) return;
                
                this.x += this.speed;
                this.wobble += (this.isBoosted ? 0.5 : 0.3);

                this.nextSoundTime -= deltaTime;
                if (this.nextSoundTime <= 0) {
                    playSound(isSnailMode ? 'snail' : 'duck');
                    const baseDelay = isSnailMode ? 1600 : 1000;
                    const randomRange = isSnailMode ? 1000 : 600;
                    this.nextSoundTime = Math.random() * randomRange + baseDelay;
                }

                const currentSplashColor = this.isBoosted ? this.colorTheme.boost : this.colorTheme.normal;

                if (isSnailMode) {
                    if (Math.random() < 0.5) {
                        this.splashes.push(new Splash(this.x - 5, this.y + 12, this.speed, false, currentSplashColor));
                    }
                } else {
                    if (Math.random() < this.speed * 0.8) {
                        this.splashes.push(new Splash(this.x - 10, this.y + 10, this.speed, this.isBoosted, currentSplashColor));
                    }
                    if (this.isBoosted) {
                        for(let i=0; i<3; i++) {
                            this.splashes.push(new Splash(this.x - 5, this.y + 10, this.speed, true, currentSplashColor));
                        }
                    }
                }

                this.splashes.forEach((s, i) => {
                    s.update();
                    if (s.alpha <= 0) this.splashes.splice(i, 1);
                });

                if (this.x >= finishLineX) {
                    this.finished = true;
                    this.x = finishLineX;
                    handleDuckFinish(this);
                }
            }

            draw(ctx) {
                this.splashes.forEach(s => s.draw(ctx));

                const bounceY = Math.sin(this.wobble) * (this.isBoosted ? 5 : 3);
                
                ctx.beginPath();
                ctx.strokeStyle = "rgba(255,255,255,0.4)";
                ctx.lineWidth = 1;
                ctx.setLineDash([5, 5]);
                ctx.moveTo(0, (this.laneIndex + 1) * LANE_HEIGHT + TOP_PADDING);
                ctx.lineTo(ctx.canvas.width, (this.laneIndex + 1) * LANE_HEIGHT + TOP_PADDING);
                ctx.stroke();

                if (isSnailMode) {
                    ctx.font = `${DUCK_DISPLAY_SIZE}px serif`;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("üêå", this.x, this.y + bounceY);
                } else if (duckImage.complete) {
                    ctx.save();
                    if (this.isBoosted && !this.finished) {
                        ctx.translate(this.x, this.y + bounceY);
                        ctx.rotate(-0.1); 
                        ctx.drawImage(duckImage, -DUCK_DISPLAY_SIZE/2, -DUCK_DISPLAY_SIZE/2, DUCK_DISPLAY_SIZE, DUCK_DISPLAY_SIZE);
                    } else {
                        ctx.drawImage(
                            duckImage, 
                            this.x - DUCK_DISPLAY_SIZE / 2, 
                            this.y + bounceY - DUCK_DISPLAY_SIZE / 2, 
                            DUCK_DISPLAY_SIZE, 
                            DUCK_DISPLAY_SIZE
                        );
                    }
                    ctx.restore();
                }

                ctx.fillStyle = this.isBoosted && !this.finished ? "#b45309" : "#334155";
                ctx.font = this.isBoosted && !this.finished ? "bold 13px 'Plus Jakarta Sans'" : "bold 11px 'Plus Jakarta Sans'";
                ctx.textAlign = "center";
                ctx.fillText(this.name + (this.isBoosted && !this.finished ? " ‚ö°" : ""), this.x, this.y + bounceY - 28);
                
                if (this.finished && this.rank > 0) {
                    ctx.save();
                    ctx.translate(this.x + 40, this.y + bounceY); 
                    ctx.beginPath();
                    ctx.arc(0, 0, 16, 0, Math.PI * 2);
                    let color = "#e2e8f0"; 
                    let textColor = "#475569";
                    if (this.rank === 1) { color = "#fcd34d"; textColor = "#92400e"; } 
                    else if (this.rank === 2) { color = "#cbd5e1"; textColor = "#334155"; } 
                    else if (this.rank === 3) { color = "#fdba74"; textColor = "#9a3412"; } 
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.fillStyle = textColor;
                    ctx.font = "bold 14px 'Plus Jakarta Sans'";
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("#" + this.rank, 0, 0);
                    ctx.restore();
                }
            }
        }

        let lastFrameTime = 0;

        function prepareRace() {
            const names = getList(namesInput.value);
            const rawTasks = getList(tasksInput.value);

            if (names.length === 0 || rawTasks.length === 0) {
                errorMsg.textContent = "Please provide both students and tasks!";
                errorMsg.classList.remove('hidden');
                return;
            }
            errorMsg.classList.add('hidden');

            tasksList = [...rawTasks];
            while (tasksList.length < names.length) {
                tasksList = tasksList.concat(rawTasks);
            }

            startBtn.disabled = true;
            resultsSection.classList.add('hidden');
            resultsContainer.innerHTML = '';
            resultsData = [];
            raceContainer.classList.remove('hidden');

            const containerWidth = raceContainer.clientWidth;
            raceCanvas.width = containerWidth;
            raceCanvas.height = names.length * LANE_HEIGHT + TOP_PADDING + 30;

            ducks = names.map((name, i) => new Duck(name, i));
            finishedDucks = 0;
            lastSpeedUpdate = performance.now();
            lastFrameTime = performance.now();

            if (animationId) cancelAnimationFrame(animationId);
            animate(performance.now());
            raceContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function animate(currentTime) {
            const deltaTime = currentTime - lastFrameTime;
            lastFrameTime = currentTime;

            const finishLineX = raceCanvas.width - FINISH_LINE_PADDING;
            ctx.clearRect(0, 0, raceCanvas.width, raceCanvas.height);

            const grd = ctx.createLinearGradient(0, 0, 0, raceCanvas.height);
            grd.addColorStop(0, "#bae6fd");
            grd.addColorStop(1, "#7dd3fc");
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, raceCanvas.width, raceCanvas.height);

            ctx.fillStyle = "#fff";
            ctx.fillRect(finishLineX, 0, 6, raceCanvas.height);
            
            const cS = 12;
            for(let y=0; y<raceCanvas.height; y+=cS) {
                ctx.fillStyle = (Math.floor(y/cS) % 2 === 0) ? "#1e293b" : "#fff";
                ctx.fillRect(finishLineX + 6, y, cS, cS);
            }

            if (currentTime - lastSpeedUpdate >= SPEED_UPDATE_INTERVAL) {
                let lastDuck = null;
                let minX = Infinity;
                
                const activeDucks = ducks.filter(d => !d.finished);
                activeDucks.forEach(d => {
                    if (d.x < minX) {
                        minX = d.x;
                        lastDuck = d;
                    }
                });

                ducks.forEach(d => {
                    if (!d.finished) {
                        d.setRandomSpeed(d === lastDuck);
                    } else {
                        d.isBoosted = false;
                    }
                });
                lastSpeedUpdate = currentTime;
            }

            let allDone = true;
            ducks.forEach(d => {
                d.update(finishLineX, deltaTime);
                d.draw(ctx);
                if (!d.finished) allDone = false;
            });

            if (!allDone) {
                animationId = requestAnimationFrame(animate);
            } else {
                finishBtnState();
            }
        }

        function handleDuckFinish(duck) {
            finishedDucks++;
            duck.rank = finishedDucks; 
            const task = tasksList[finishedDucks - 1];
            resultsData.push({ name: duck.name, task, rank: finishedDucks });
            
            const row = document.createElement('div');
            row.className = "result-row bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center justify-between";
            row.style.animationDelay = `${finishedDucks * 0.1}s`;
            
            let rankStyle = "bg-slate-100 text-slate-500";
            if (finishedDucks === 1) rankStyle = "bg-amber-100 text-amber-600 ring-2 ring-amber-300";
            if (finishedDucks === 2) rankStyle = "bg-slate-200 text-slate-700 ring-2 ring-slate-300";
            if (finishedDucks === 3) rankStyle = "bg-orange-100 text-orange-600 ring-2 ring-orange-200";

            row.innerHTML = `
                <div class="flex items-center gap-4">
                    <div class="w-8 h-8 shrink-0 flex items-center justify-center font-black rounded-lg text-xs ${rankStyle}">
                        ${finishedDucks}
                    </div>
                    <span class="font-bold text-slate-800">${duck.name}</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-slate-300 text-xs font-bold uppercase tracking-widest">Part:</span>
                    <span class="px-3 py-1 bg-sky-50 text-sky-600 font-bold rounded-md text-sm">${task}</span>
                </div>
            `;
            resultsContainer.appendChild(row);
        }

        function finishBtnState() {
            startBtn.disabled = false;
            startBtn.innerHTML = `<span>üîÑ Re-run ${isSnailMode ? 'Snail ' : ''}Race</span>`;
            resultsSection.classList.remove('hidden');
            fireConfetti();
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 300);
        }

        function copyResults() {
            const text = resultsData
                .map(r => `${r.name} - ${r.task}`)
                .join('\n');
            
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            const originalBtn = copyBtn.innerHTML;
            copyBtn.innerHTML = "‚úÖ Copied!";
            copyBtn.classList.replace('bg-emerald-500', 'bg-slate-800');
            setTimeout(() => {
                copyBtn.innerHTML = originalBtn;
                copyBtn.classList.replace('bg-slate-800', 'bg-emerald-500');
            }, 2000);
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti');
            const c = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            let particles = Array.from({ length: 100 }).map(() => ({
                x: Math.random() * canvas.width,
                y: -20,
                r: Math.random() * 4 + 4,
                color: `hsl(${Math.random() * 360}, 80%, 60%)`,
                speed: Math.random() * 4 + 2,
                wobble: Math.random() * 10,
                wobbleSpeed: Math.random() * 0.1
            }));

            function drawConfetti() {
                c.clearRect(0, 0, canvas.width, canvas.height);
                let activeParticles = false;
                particles.forEach(p => {
                    p.y += p.speed;
                    p.wobble += p.wobbleSpeed;
                    p.x += Math.sin(p.wobble);
                    if (p.y < canvas.height + 20) {
                        activeParticles = true;
                        c.beginPath();
                        c.fillStyle = p.color;
                        c.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                        c.fill();
                    }
                });
                if (activeParticles) {
                    requestAnimationFrame(drawConfetti);
                } else {
                    c.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            drawConfetti();
        }

        updateCounts();
    </script>
</body>
</html>
